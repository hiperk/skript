#Dev 1.2#
#- - - - - - - - -[G-Chat]- - - - - - - - #----------------------------------#
#→Autor: hiperk                           #→G-Chat w wersji v1.0             #
#→komendy:                                #→Wymagania:                       #
#→/chat cc - czyści chat                  #→Skript wersja 2.0.2 (lub nowsza) #
#→/chat off - blokuje chat                #→WildSkript na 1.9                #
#→/chat on - odblokowywuje chat           #→SkQuery Najnowsze                #   
#→/chat slowmode - pomoc odnośnie skryptu #----------------------------------#
#→/chat automsg - wlacza automessage      #
#→/chat bb - Ogloszenia co 5 minut        #
#- - - - - - - - -[G-Chat]- - - - - - - - #
#----------------licencja-----------------#
#→Zezwalam na edycję skryptu              #
#→Zakaz usuwania autora oraz licencji     #
#→Zabraniam sprzedaży skryptu             #
#→Zakaz podszywania sie pod autora skryptu#
#-----------------------------------------#
#----------------#
#    →Config     #
#----------------#
on load:
	if folder "plugins/G-Chat" doesn't exists:
		send "&cNie odnaleziono folderu G-Chat" to console
		send "&aTworzenie..." to console
		create folder "plugins/G-Chat"
		send "&aFolder G-Chat zostal pomyslnie stworzony" to console
	if file "plugins/G-Chat/config.yml" doesn't exists:
		send "&cNie odnaleziono pliku config.yml" to console
		send "&aTworzenie..." to console
		create file "plugins/G-Chat/config.yml"
		download from "https://raw.githubusercontent.com/hiperk/skript/master/config.yml" to "plugins/G-Chat/config.yml"
		send "&aPlik config zostal pomyslnie stworzony" to console
on script load:
	set {tagserv} to colored single value "tag" get of "plugins/G-Chat/config.yml"
	set {slowmodetime} to single value "Slowmode.time" get of "plugins/G-Chat/config.yml" parsed as integer
	set {slowmode} to yaml value "Slowmode.Active" from "plugins/G-Chat/config.yml"
	set {automsg::*} to configuration section "automsg" get of "plugins/G-Chat/config.yml"
	set {AutoMSG::active} to yaml value "AutoMSG.Active" from "plugins/G-Chat/config.yml"
	set {tagmsg} to colored single value "TAG.AutoMsg" get of "plugins/G-Chat/config.yml"
	set {tag::active} to yaml value "TAG.Active" from "plugins/G-Chat/config.yml"
	set {bbmsg} to yaml value "BB.Cast.message" from "plugins/G-Chat/config.yml"
	set {bb::active} to yaml value "BB.Cast.Active" from "plugins/G-Chat/config.yml"
on load:    
	if {_x} isn't set:                
		set {_x2} to result of connect to "https://raw.githubusercontent.com/hiperk/skript/master/wersja"                
	if {_x3} is {_x2}:                    
		delete {_x2}                    
		stop                        
	download "https://raw.githubusercontent.com/hiperk/skript/master/chatt" to "plugins/Skript/scripts/%script%.sk"            
	set {_x3} to {_x2}            
	delete {_x}           
	delete {_x2}           
	set {_x} to false

#----------------#
#    →zmienne    #
#----------------#
variables:
	{chat} = true
	{spam::%player%} = false
	{chat::%player%} = 0
#----------------#
#    →opcje      #
#----------------#
options:
	tag: &f&l[&2G&f-&4CHAT&f&l]
	msgtime: 10
#----------------#
#   →Kod skryptu #
#----------------#
command /chat [<text>] [<text>]:
	trigger:
		if arg 1 is not set:
			send "&8> &cBrak Komend &ewyszla nowa wersja z G-Chat"
		if arg 1 is "on":
			if player has permission "chat.admin.on":
				if {chat} is true:
					set {chat} to false
					set {ChatReson::active}  to false
					clear {ChatReson}
					broadcast ""
					broadcast "                     %{tagserv}%"
					broadcast ""
					broadcast "&8> &aChat zostal wlaczony przez &8%player%"
					broadcast ""
					broadcast ""
				else:
					send "{@tag} &4Chat aktualnie jest wlaczony"
			else:
				send "{@tag} &4Nie masz uprawnien do tej komendy &7(chat.admin.on)"
		if arg 1 is "off":
			if player has permission "chat.admin.off":
				if {chat} is false:
					if arg 2 is not set:
						set {chat} to true
						set {ChatReson::active}  to false
						broadcast ""
						broadcast "                     %{tagserv}%"
						broadcast ""
						broadcast "&8> &aChat zostal wylaczony przez &8%player%"
						broadcast ""
						broadcast ""
					else:
						set {chat} to true
						set {ChatReson::active}  to true
						set {ChatReson} to arg 2
						broadcast ""
						broadcast "                     %{tagserv}%"
						broadcast ""
						broadcast "&8> &aChat zostal wylaczony przez &8%player%"
						broadcast ""
						broadcast "&8> &aPowód: &c%arg 2%"
						broadcast ""
				else:
					send "{@tag} &4Chat aktualnie jest wylaczony"
			else:
				send "{@tag} &4Nie masz uprawnien do tej komendy &7(chat.admin.off)"
		if arg 1 is "cc" or "c" or "wyczysc" or "clear":
			if player has permission "chat.admin.cc":
				loop 150 times:
					broadcast " "
				broadcast "                     %{tagserv}%"
				broadcast ""
				broadcast "&8> &aChat zostal wyczyszczony przez &8%player%"
				broadcast ""
				broadcast ""
				broadcast ""
				broadcast ""
			else:
				send "{@tag} &4Nie masz uprawnien do tej komendy &7(chat.admin.cc)"
		if arg 1 is "reload":
			if player has permission "chat.admin.reload":
				send "{@tag} &6Skrypt &a%script% &6zostal przeladowany"
				execute console command "skript reload %script%"
		if arg 1 is "slowmode":
			if player has permission "chat.admin.slowmode.toggle":
				if {slowmode} is false:
					set {slowmode} to true
					send "{@tag} &6Wlaczyles slowmode na czacie"
					stop
				else if {slowmode} is true:
					set {slowmode} to false
					send "{@tag} &6Wylaczyles slowmode na czacie"
					stop
			else:
				send "{@tag} &4Nie masz uprawnien do tej komendy &7(chat.admin.slowmode.toggle)"
		if arg 1 is "automsg":
			if player has permission "chat.admin.automsg.toogle":
				if {AutoMSG::active} is false:
					set {AutoMSG::active} to true
					send "{@tag} &6Wlaczyles automessage"
					stop
				else if {AutoMSG::active} is true:
					set {AutoMSG::active} to false
					send "{@tag} &6Wylaczyles automessage"
					stop
			else:
				send "{@tag} &4Nie masz uprawnien do tej komendy &7(chat.admin.automsg.toggle)"
		if arg 1 is "bb":
			if player has permission "chat.vip.bb":
				if {bb::active} is true:
					if arg 2 is set:
						if player has permission "chat.vip.bb.only":
							set {_bbmsg} to {bbmsg}
							replace all "(nick)" with "%player%" in {_bbmsg}
							replace all "(tresc)" with "%colored arg 2%" in {_bbmsg}
							set {_bbtresc} to coloured {_bbmsg}
							broadcast "%{_bbtresc}%"
						else:
							if difference between {bb::%player%::lastused} and now is less than 5 seconds:
								send "{@tag} &cJeszcze nie mozesz uzywac %difference between {bb::%player%::lastused} and now%"
							else:
								set {_bbmsg} to {bbmsg}
								replace all "(nick)" with "%player%" in {_bbmsg}
								replace all "(tresc)" with "%colored arg 2%" in {_bbmsg}
								set {_bbtresc} to coloured {_bbmsg}
								broadcast "%{_bbtresc}%"
								set {bb::%player%::lastused} to now
					else:
						send "{@tag} &eUzyj: &a/&echat bb &a<&eWiaodmosc&a>"
				else:
					send "{@tag} &4BB-Coast jest wylaczone"
			else:
				send "{@tag} &4Nie masz uprawnien do tej komendy &7(chat.vip.bb)"
#-------------------------------------------|------[Koniec Kodu]------|--------------------------------------#
#----------------#
#   →Wydarzenia  #
#----------------#
on chat:
	if {chat} is true:
		if player don't have permission "chat.say":
			cancel event
			if {ChatReson::active} is true:
				send "&8> &cChat zostal wylaczony &7(Powód: %{ChatReson}%)"
			else:
				send "&8> &cChat zostal wylaczony"
on chat:
	if {chat} is false:
		if {slowmode} is true:
			if player don't have permission "chat.slowmode":
				if {chat::%player%} < 1:
					set {chat::%player%} to {slowmodetime}
					stop
				if {chat::%player%} > 0:
					send "&8> &6Nastepna wiadomosc bedziesz mogl wyslac za: &c%{chat::%player%}% &6sekund!"
					cancel event
				else:	 
					if {chat::%player%} < 1:
						set {chat::%player%} to {slowmodetime}
						stop
every 1 seconds:
	loop all players:
		remove 1 from {chat::%loop-player%}

every {@msgtime} seconds:
	if {AutoMSG::active} is true:
		if {msgadds} is not set:
			set {msgadds} to 1
		loop 30 times:
			set {_wiad.%loop-number%} to coloured single value "automsg.%loop-number%" get of "plugins/G-Chat/config.yml" parsed as text
		if {tag::active} is true:
			broadcast "%{tagmsg}% %{_wiad.%{msgadds}%}%"
		else:
			broadcast "%{_wiad.%{msgadds}%}%"
		add 1 to {msgadds}
		if {_wiad.%{msgadds}%} is set:
			stop
		else:
			set {msgadds} to 1
#-------------------------------------------|------[Koniec Skryptu]------|--------------------------------------#
#                                           |_  wykonanego przez hiperk _|                                      #
